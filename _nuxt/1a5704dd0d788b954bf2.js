(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{248:function(t,e,r){var content=r(258);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(53).default)("85f4b3ec",content,!0,{sourceMap:!1})},257:function(t,e,r){"use strict";var n=r(248);r.n(n).a},258:function(t,e,r){(e=r(52)(!1)).push([t.i,".step-button.forbid[data-v-52bcaf88]{cursor:not-allowed;opacity:.5}",""]),t.exports=e},260:function(t,e,r){"use strict";var n={props:{disabled:{type:Boolean,default:!1},to:{type:String,default:""},primary:{type:Boolean,default:!1}},computed:{buttonClass:function(){var t=[this.disabled?"forbid":"pointer"];return this.primary?t.push("white","bg-green"):t.push("green","bg-white"),t}},methods:{handleClick:function(t){!this.disabled&&this.to&&this.$router.push(this.to),this.$emit("click",t)}}},o=(r(257),r(42)),component=Object(o.a)(n,(function(){var t=this.$createElement;return(this._self._c||t)("button",{staticClass:"step-button ba br2 b--green ph3 pv2 tc w-100",class:this.buttonClass,attrs:{disabled:this.disabled},on:{click:this.handleClick}},[this._t("default")],2)}),[],!1,null,"52bcaf88",null);e.a=component.exports},262:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var n={created:function(){this.$store.state.barcode||this.$router.push("/create-item/scan")}}},263:function(t,e,r){var content=r(282);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(53).default)("c28124f6",content,!0,{sourceMap:!1})},281:function(t,e,r){"use strict";var n=r(263);r.n(n).a},282:function(t,e,r){(e=r(52)(!1)).push([t.i,".badge[data-v-5157a64c]{background:#f6f6f6}.badge a[data-v-5157a64c]{text-decoration:none}",""]),t.exports=e},304:function(t,e,r){"use strict";r(281);var n=r(42),component=Object(n.a)({},(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"badge pa3 tc"},[e("a",{ref:"noopener",staticClass:"db dim",attrs:{width:"150",height:"50",href:"https://auth0.com/?utm_source=oss&utm_medium=gp&utm_campaign=oss",target:"_blank",alt:"Single Sign On & Token Based Authentication - Auth0"}},[e("img",{attrs:{width:"150",height:"50",alt:"JWT Auth for open source projects",src:"//cdn.auth0.com/oss/badges/a0-badge-light.png"}}),e("div",{staticClass:"f6 gray"},[this._v("登入認證服務由 Auth0 提供")])])])}),[],!1,null,"5157a64c",null);e.a=component.exports},397:function(t,e,r){"use strict";r.r(e);r(109),r(55),r(35),r(26),r(65),r(66),r(54);var n=r(8),o=r(12),c=r(84),l=r(262),d=r(260),f=r(304),h=r(110),m=r(156);function v(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function y(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var x={components:{StepButton:d.a,Auth0Badge:f.a},mixins:[l.a],data:function(){return{isUploading:!0,isSucceeded:!0}},computed:y({},Object(c.b)(["totalItems"])),created:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.$store.state,["barcode","itemName","companyInfo","mainCat","coverImage","detailImage"].every((function(t){return!!r[t]}))){e.next=6;break}return t.$router.push("/create-item/scan"),e.abrupt("return");case 6:return e.next=8,t.uploadIt();case 8:t.isSucceeded=e.sent;case 9:case"end":return e.stop()}}),e)})))()},methods:{oneShot:function(data){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.$store.state.barcode,n="".concat("https://thaubing.gcaa.org.tw","/json/product/create"),o={headers:{"x-thaubing-api-key":t.$auth.user["https://ddio.io/meta-key"]}},data=y({barcode:r},data),e.prev=4,e.next=7,t.$axios.post(n,data,o);case 7:if(1===(c=e.sent).data.success){e.next=11;break}return alert("上傳錯誤：\n"+c.data.errors.join("\n\t")),e.abrupt("return",!1);case 11:e.next=18;break;case 13:return e.prev=13,e.t0=e.catch(4),console.error(e.t0),alert("上傳錯誤： ".concat(e.t0)),e.abrupt("return",!1);case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e,null,[[4,13]])})))()},updateMirror:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.$store.state,n=r.companyInfo,o={barcode:r.barcode,origName:n.origName,id:n.id,name:n.name},e.next=5,Object(h.b)("/mirror/ping",o);case 5:(c=e.sent).data.success&&t.$store.commit(m.MUTATIONS.SET_TOTAL_ITEMS,c.data.sum);case 7:case"end":return e.stop()}}),e)})))()},uploadIt:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isUploading=!0,r=t.$store.state,n={corp_name:r.companyInfo.name,category:r.mainCat,product_name:r.itemName},r.companyInfo.id&&!r.companyInfo.origName&&(n.corp_id=r.companyInfo.id),r.subCat&&(n.category_sub=r.subCat),e.prev=5,e.next=8,t.oneShot(n);case 8:if(e.sent){e.next=12;break}return t.isUploading=!1,e.abrupt("return",!1);case 12:return e.next=14,t.oneShot({photo_is_primary:1,photo:r.coverImage});case 14:if(e.sent){e.next=18;break}return t.isUploading=!1,e.abrupt("return",!1);case 18:return e.next=20,t.oneShot({photo:r.detailImage});case 20:if(e.sent){e.next=24;break}return t.isUploading=!1,e.abrupt("return",!1);case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(5),console.error(e.t0),alert("上傳錯誤： ".concat(e.t0));case 30:return e.prev=30,e.next=33,t.updateMirror();case 33:e.next=38;break;case 35:e.prev=35,e.t1=e.catch(30),console.error("error when backup",e.t1);case 38:return t.$store.commit(m.MUTATIONS.RESET_ITEM),t.isUploading=!1,e.abrupt("return",!0);case 41:case"end":return e.stop()}}),e,null,[[5,26],[30,35]])})))()}}},w=r(42),component=Object(w.a)(x,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"done min-vh-100 flex flex-column justify-between"},[r("div",{staticClass:"flex items-center justify-center pa3 flex-auto"},[t.isUploading?r("div",{staticClass:"tc"},[t._v("上傳中"),r("i",{staticClass:"fas fa-spinner fa-pulse ml3"})]):r("div",{staticClass:"tc"},[t.isSucceeded?r("div",{staticClass:"lh-copy"},[r("h1",{staticClass:"mv2 green f2"},[t._v("上傳完成")]),r("div",{staticClass:"f5"},[t._v("(ﾉ´▽｀)ﾉ♪")]),r("div",{staticClass:"f5"},[t._v("產品紀錄量來到")]),r("div",{staticClass:"f2 white mv2 b bg-yellow dib ph3"},[t._v(t._s(t.totalItems.toLocaleString()))]),r("div",{staticClass:"f5"},[t._v("筆囉！")])]):r("div",[r("h1",{staticClass:"lh-copy"},[t._v("上傳失敗")]),r("div",{staticClass:"f4"},[t._v("ヽ(￣д￣;)ノ")])]),r("step-button",{staticClass:"mt4",attrs:{primary:!0,to:"/create-item/scan"}},[t._v("再來一筆")])],1)]),r("auth0-badge")],1)}),[],!1,null,null,null);e.default=component.exports}}]);