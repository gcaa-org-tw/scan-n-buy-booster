(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{248:function(e,t,r){var content=r(258);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(53).default)("85f4b3ec",content,!0,{sourceMap:!1})},257:function(e,t,r){"use strict";var n=r(248);r.n(n).a},258:function(e,t,r){(t=r(52)(!1)).push([e.i,".step-button.forbid[data-v-52bcaf88]{cursor:not-allowed;opacity:.5}",""]),e.exports=t},260:function(e,t,r){"use strict";var n={props:{disabled:{type:Boolean,default:!1},to:{type:String,default:""},primary:{type:Boolean,default:!1}},computed:{buttonClass:function(){var e=[this.disabled?"forbid":"pointer"];return this.primary?e.push("white","bg-green"):e.push("green","bg-white"),e}},methods:{handleClick:function(e){!this.disabled&&this.to&&this.$router.push(this.to),this.$emit("click",e)}}},c=(r(257),r(42)),component=Object(c.a)(n,(function(){var e=this.$createElement;return(this._self._c||e)("button",{staticClass:"step-button ba br2 b--green ph3 pv2 tc w-100",class:this.buttonClass,attrs:{disabled:this.disabled},on:{click:this.handleClick}},[this._t("default")],2)}),[],!1,null,"52bcaf88",null);t.a=component.exports},275:function(e,t,r){"use strict";var n=r(42),component=Object(n.a)({},(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"vertical-step min-vh-100 w-100 flex flex-column justify-between"},[t("div",{staticClass:"vertical-step__head"},[this._t("head")],2),t("div",{staticClass:"vertical-step__content pv3"},[this._t("default")],2),t("div",{staticClass:"vertical-step__tail"},[this._t("tail")],2)])}),[],!1,null,null,null);t.a=component.exports},300:function(e,t,r){var content=r(381);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(53).default)("63aa0ed4",content,!0,{sourceMap:!1})},380:function(e,t,r){"use strict";var n=r(300);r.n(n).a},381:function(e,t,r){(t=r(52)(!1)).push([e.i,".scan video[data-v-f2b9ce60]{height:40vh}.scan video.disabled[data-v-f2b9ce60]{opacity:.3}.scan .forbid[data-v-f2b9ce60]{cursor:not-allowed}.scan__code-label[data-v-f2b9ce60]{width:3.5rem}.scan__code-input[data-v-f2b9ce60]{width:calc(100% - 3.5rem)}",""]),e.exports=t},398:function(e,t,r){"use strict";r.r(t);r(109),r(55),r(35),r(26),r(65),r(66),r(335),r(54);var n=r(8),c=r(12),o=r(305),l=r(84),d=r(156),f=r(275),m=r(260);function v(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}var h={components:{VerticalStep:f.a,StepButton:m.a},data:function(){return{codeReader:new o.BrowserBarcodeReader,cameras:[],targetCameraId:null,hasNoCamera:!1,isOnScan:!1,isManual:!1,barcode:"",detectorTimeout:null}},computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(t){Object(c.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(l.b)(["forceManual"]),{onlyOnyCamera:function(){return this.cameras.length<2},canForceManual:function(){return!this.isManual&&!this.isOnScan},manualSwitcherText:function(){return this.forceManual?"切換為半自動模式":"切換為純手動模式"}}),watch:{targetCameraId:function(e){localStorage.setItem("gcaa_camera_session_key",e),this.startScanOnce()},barcode:function(e){this.$store.commit(d.MUTATIONS.SET_BARCODE,e.trim())}},created:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.$store.commit(d.MUTATIONS.RESET_ITEM),t.next=3,e.codeReader.getVideoInputDevices();case 3:if(r=t.sent,e.cameras=r.map((function(e){return{label:e.label,id:e.deviceId}})),!e.forceManual){t.next=8;break}return e.typeManually(),t.abrupt("return");case 8:if(!(e.cameras.length<1)){t.next=11;break}return e.hasNoCamera=!0,t.abrupt("return");case 11:1===e.cameras.length?e.targetCameraId=e.cameras[0].id:(n=localStorage.getItem("gcaa_camera_session_key",""),c=e.cameras.find((function(e){return e.id===n})),e.targetCameraId=c?c.id:e.cameras[0].id),e.detectNeedManual();case 13:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.codeReader.reset(),clearTimeout(this.detectorTimeout)},methods:{typeManually:function(){var e=this;this.isManual=!0,this.codeReader.reset(),this.$nextTick((function(){e.$refs.input&&e.$refs.input.focus()}))},toggleForceManual:function(){this.forceManual?this.startScanOnce():this.typeManually(),this.$store.commit(d.MUTATIONS.SET_MANUAL_MODE,!this.forceManual)},detectNeedManual:function(){var e=this;this.detectorTimeout=setTimeout((function(){e.canForceManual&&(confirm("我沒辦法找到相機，可以幫忙切換成手動模式嗎？\n(◕‿◕)")&&e.toggleForceManual())}),1e3)},startScanOnce:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.targetCameraId){t.next=2;break}return t.abrupt("return");case 2:return e.isManual=!1,e.isOnScan=!0,e.barcode="",t.prev=5,t.next=8,e.codeReader.decodeOnceFromVideoDevice(e.targetCameraId,e.$refs.barcodeVideo);case 8:r=t.sent,e.barcode=r.text,t.next=16;break;case 12:t.prev=12,t.t0=t.catch(5),"NotFoundException"===t.t0.name?console.error("Camera not found"):"NotAllowedError"===t.t0.name?alert("我沒辦法打開相機，請手動輸入 ⊙﹏⊙"):console.error(t.t0),e.typeManually();case 16:return t.prev=16,e.isOnScan=!1,t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[5,12,16,19]])})))()}}},w=(r(380),r(42)),component=Object(w.a)(h,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("vertical-step",{staticClass:"scan pa3"},[r("template",{slot:"head"},[r("div",{staticClass:"gray"},[e._v("第 ➀ 步")]),r("h1",{staticClass:"f3 mv0"},[e._v("掃描產品條碼")])]),e.cameras.length||!e.hasNoCamera?r("div",[r("button",{staticClass:"ba br2 b--silver pv2 ph3 mb2 w-100 silver bg-white",on:{click:e.toggleForceManual}},[e._v(e._s(e.manualSwitcherText))]),r("div",[r("video",{ref:"barcodeVideo",staticClass:"bg-moon-gray w-100",class:{disabled:e.barcode}}),r("div",{staticClass:"pa2 mv2 bb b--green w-100 flex"},[r("div",{staticClass:"scan__code-label"},[e._v("條碼：")]),r("div",{staticClass:"scan__code-input"},[r("div",{directives:[{name:"show",rawName:"v-show",value:!e.isManual,expression:"!isManual"}],staticClass:"w-100"},[e._v(e._s(e.barcode||"等待掃描中..."))]),r("input",{directives:[{name:"show",rawName:"v-show",value:e.isManual,expression:"isManual"},{name:"model",rawName:"v-model",value:e.barcode,expression:"barcode"}],ref:"input",staticClass:"bw0 w-100",attrs:{type:"text",inputmode:"numeric",placeholder:"請輸入條碼"},domProps:{value:e.barcode},on:{input:function(t){t.target.composing||(e.barcode=t.target.value)}}})])]),r("div",{staticClass:"flex"},[r("div",{staticClass:"w-50 pr2"},[r("select",{directives:[{name:"model",rawName:"v-model",value:e.targetCameraId,expression:"targetCameraId"}],staticClass:"h-100 w-100",class:{forbid:e.onlyOnyCamera},attrs:{disabled:e.onlyOnyCamera},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.targetCameraId=t.target.multiple?r:r[0]}}},e._l(e.cameras,(function(t){return r("option",{domProps:{value:t.id}},[e._v(e._s(t.label))])})),0)]),r("div",{staticClass:"w-50 pl2"},[r("button",{directives:[{name:"show",rawName:"v-show",value:e.isOnScan&&!e.isManual,expression:"isOnScan && !isManual"}],staticClass:"ba gold bg-white b--gold pv2 ph3 w-100 br2 pointer",on:{click:e.typeManually}},[e._v("手動輸入")]),r("button",{directives:[{name:"show",rawName:"v-show",value:!e.isOnScan||e.isManual,expression:"!isOnScan || isManual"}],staticClass:"ba gold bg-white b--gold pv2 ph3 w-100 br2 pointer",on:{click:e.startScanOnce}},[e._v("重新掃描")])])])])]):r("div",[r("h2",{staticClass:"tc"},[e._v("找不到相機，請詢問工作人員 ⊙﹏⊙")])]),r("template",{slot:"tail"},[r("step-button",{attrs:{to:"/create-item/confirm-company",disabled:!e.barcode,primary:!0}},[e._v("下一步")])],1)],2)}),[],!1,null,"f2b9ce60",null);t.default=component.exports}}]);